*Do I need to change any parameters or can I stick to the defaults?* - The default parameters have been set for optimal results when running de-novo consensus mode or variant calling mode with a single amplicon per sample with amplicon sizes between 500 and 5,000 bp.
When running variant calling mode with several amplicons per sample, we recommend setting `--drop_frac_longest_reads 0 --take_longest_remaining_reads false`.
Also, when your amplicons are very long or short, it might be a good idea to change the minimum read length filter cutoff.
For more details, please refer to the [Pipeline Overview](#pipeline-overview).

*How can I select which reference is paired with which sample when running variant calling mode with multiple amplicons?* - If you want to map specific reference sequences to specific amplicons, you can add a column named `ref` containing the respective target reference IDs to the sample sheet.
If a barcode should be aligned against multiple reference sequences, their IDs can be included as a space-delimited list.
If a specific sample should be aligned against all references, you can leave the corresponding cell in the `ref` column blank.
Consider the following example with 4 barcodes and 2 sequences in the reference file. The sample sheet tells the workflow that the first two barcodes (`sample1` and `sample2`) are expected to contain
reads from both amplicons in the reference, whereas the other two samples only contain one amplicon each.

```
barcode,alias,type,ref
barcode01,sample1,test_sample,katG::NC_000962.3:2154725-2155670 rpoB::NC_000962.3:760285-761376
barcode02,sample2,test_sample,
barcode03,sample3,positive_control,katG::NC_000962.3:2154725-2155670
barcode04,sample4,test_sample,rpoB::NC_000962.3:760285-761376
```

*How much coverage do I need?* - We recommend >150X average coverage across the individual amplicons.
1500 reads per amplicon should thus be enough in the vast majority of cases.
You can speed up execution time by setting `--reads_downsampling_size 1500` (or to a smaller number if your amplicons are not longer than a few kb).

*Why does the workflow select reads based on length rather than random downsampling per default?* - Despite the workflow dropping reads containing adapter sequences in the middle (using `porechop --discard_middle`), some reads in the input data stemming from concatemers or other PCR artifacts might still make it through preprocessing and could thus interfere with consensus generation.
A simple way to avoid this is to drop a small fraction (e.g. 5%) of longest reads.
Furthermore, `spoa` depends on the order of reads in the input and benefits from "seeing" longer reads first.
Therefore, the following workflow options are used per default `--drop_frac_longest_reads 0.05 --take_longest_remaining_reads`.
This essentially drops the longest 5% of reads and then takes selects the next longest reads (either all of them or the number specified with `--reads_downsampling_size`).
To disable the default behaviour and enforce random downsampling of input reads, use `--drop_frac_longest_reads 0 --take_longest_remaining_reads false`.
Disabling the default behaviour in favour of random downsampling is generally recommended when running variant calling mode with multiple amplicons per sample.

*Is there a difference between the consensus sequences created in variant calling and de-novo consensus mode?* - In variant calling mode, the consensus sequence is generated by applying the variants found by [Medaka](https://github.com/nanoporetech/medaka) to the provided reference.
This comes with the caveat that structural variants too large to be detected by Medaka are not going to be represented in the consensus.
For this reason we suggest to always have a look at the coverage plots in the generated HTML report.
In de-novo consensus mode, however, the consensus is generated either via assembly or [POA](https://doi.org/10.1093/bioinformatics/btg109) and no prior information besides the reads is taken into account.

If your question is not answered here, please report any issues or suggestions on the [github issues](https://github.com/epi2me-labs/wf-alignment/issues) page or start a discussion on the [community](https://community.nanoporetech.com/).
